<!-- Payment Receipt Component - Transactions Module -->

<div class="animated fadeIn">

  <!-- Receipt Details -->
  <div class="row">
    <div class="col-lg-12">
        <div class="card">
        <div class="card-header">
            <i class="fa fa-align-justify"></i>Receipt Details
        </div>
            
        <div class="card-body">
            <form [formGroup]="receiptDetails">
                <div class="form-row">

                    <!-- 1st Column -->
                    <div class="col-lg-6">
                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="text-input">Receipt Number</label>
                            <div class="col-md-6">
                                <input type="text" formControlName="receiptNumber" class="form-control">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="text-input">Cash Office</label>
                            <div class="col-md-6">
                                <input type="text" formControlName="cashOffice" class="form-control">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="text-input">Received From <span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                <input type="text" formControlName="receivedFrom" class="form-control">
                            </div>
                        </div>

                        <div class = "form-group row">
                            <label class="col-md-4 col-form-label" >Payment Method <span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                <select class="form-control" (change)="onChange($event.target.value)" formControlName="paymentMethod" required >
                                    <option *ngFor="let pm of PayMethods" [value]="pm.payMtdId">{{pm.modeName}}</option>
                                </select>
                            </div>                           
                        </div>

                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="number">Receipt Amount <span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                <input type="number" min=0 formControlName="receiptAmount" class="form-control" >
                            </div>
                        </div>

                    </div>

                    <!-- 2nd Column -->
                    <div class="col-lg-6">

                        <div class="form-group row">
                            <label class="col-md-4 col-form-label">Receipt Date</label>
                            <div class = "col-md-6">
                                <input type="text" formControlName="receiptDate" class="form-control" disabled> 
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="text-input">PostedStatus / Batch No.</label>
                            <div class="col-md-6">
                                <input type="text" formControlName="postedStatus" class="form-control">
                            </div>
                        </div>

                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="text-input">Cashier Name</label>
                            <div class="col-md-6">
                                <input type="text" formControlName="cashierName" class="form-control">
                            </div>
                        </div>

                    </div>
                </div>
            </form>
        </div>

        </div>
    </div>
  </div>

<!-- Payment Details -->
<div class="row">
    <div class="col-lg-12">
        <div class="card">
        <div class="card-header">
            <i class="fa fa-align-justify"></i>Payment Details
        </div>
            
        <div class="card-body">
            <form [formGroup]="paymentDetails">
                <div class="form-row">
    
                    <!-- 1st Column -->
                    <div class="col-lg-6">
                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="text-input">Cheque / Ref. No. <span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                <input type="text" formControlName="referenceNumber" class="form-control">
                            </div>
                        </div>

                        <div class = "form-group row">
                            <label class="col-md-4 col-form-label">Bank Name <span class="text-danger">*</span></label>
                            <div class = "col-md-6">
                                <!-- <select class="form-control" id="bankName" formControlName = "bankName">
                                        <option [ngValue]="bnkNm" *ngFor="let bnkNm of bankNames"> {{bnkNm}}</option>
                                </select> -->
                                <select class="form-control" (change)="onBankChange($event.target.value)" formControlName="bankName" required >
                                    <option *ngFor="let bn of bankNames" [value]="bn.bankCode">{{bn.bankName}}</option>
                                </select>
                            </div>
                        </div>
    
                        <div class="form-group row">
                            <label class="col-md-4 col-form-label" for="text-input">Drawee <span class="text-danger">*</span></label>
                            <div class="col-md-6">
                                <input type="text" formControlName="drawee" class="form-control">
                            </div>
                        </div>

                    </div>
    
                    <!-- 2nd Column -->
                    <div class="col-lg-6">

                        <div class="form-group row">
                            <label class="col-md-4 col-form-label">Reference Date <span class="text-danger">*</span></label>
                            <div class = "col-md-6">
                            <input class="form-control" id="reference-date" type="date" 
                                formControlName = "referenceDate" name="reference-date">
                            </div>
                        </div>

                        <div class = "form-group row">
                            <label class="col-md-4 col-form-label" >Branch Name <span class="text-danger">*</span></label>
                            <div class = "col-md-6">
                                <!-- <select class="form-control" id="branchName" formControlName = "branchName">
                                    <option [ngValue]="branchName" *ngFor="let branchName of branchNames"> {{branchName}}</option>
                                </select> -->
                                <select class="form-control" formControlName="branchName" required >
                                    <option *ngFor="let bn of branchNames" [value]="bn.branchCode">{{bn.branchName}}</option>
                                </select>
                            </div>
                        </div>
    
                    </div>
                </div>
            </form>
        </div>
    
    </div>
</div>
</div>

<!-- Receipt Applications -->
  <div class="row">
    <div class="col-lg-12">
        <div class="card">
        <div class="card-header">
            <i class="fa fa-align-justify"></i>Receipt Applications
        </div>
            
        <div class="card-body">
    
          <!-- Receipt Applications Tabs -->
          <div class= 'row'>

            <div class="col-lg-12"> 
              <tabset>

                <tab heading="TPOL" *ngIf="tpollabel">
                  <div class="card-body">
                    <form [formGroup]="myFormTPOL">
                      <div class="table-responsive"  formArrayName="correctionFormsTPOL">
                        <table class="table table-bordered table-hover">
                          <thead class="thead-light">
                            <tr>
                              <th>Activity <span class="text-danger">*</span></th> <!-- Transaction Type -->
                              <th>Period <span class="text-danger">*</span></th>
                              <th>Policy Code <span class="text-danger">*</span></th>
                              <th>Status <span class="text-danger">*</span></th>
                              <th>Payer <span class="text-danger">*</span></th>
                              <th>Arrears <span class="text-danger">*</span></th>
                              <th>Expected Amount <span class="text-danger">*</span></th>
                              <th>Allocated Amount <span class="text-danger">*</span></th>
                              <th></th>
                            </tr>
                          </thead>
                                      
                          <tbody>
                          
                            <tr *ngFor="let correction of  correctionFormsTPOL.controls; let i=index" [formGroupName]="i">
                              <td><input  formControlName="appActCode"></td>
                              <td><input  formControlName="corPeriod" ></td>
                              <td><input  formControlName="corPolicyCode" (click)="openModalWithComponent()"></td>
                              <td><input formControlName="corStatus"></td>
                              <td><input formControlName="corPayerName"></td>
                              <td><input formControlName="corArrears"></td>
                              <td><input formControlName="corExpectedAmount"></td>
                              <td><input class="form-control" type="number" name="corAllocatedAmount" ></td>
                              <td>
                                  <button type="submit" class="btn btn-md btn-primary" (click)="deleteCorrectionTPOL(i)">DELETE</button> 
                              </td>
                            </tr>
                          </tbody>
                        </table>
                         
                             <div>
                                <button type="submit" class="btn btn-md btn-primary"  
                                (click)="addCorrectionTPOL()">ADD ACTIVITY</button> 
                             </div>
                               
                          <div class="text-right font-weight-bold">
                              Amount: {{totalAmountTPOL | number : '.2-2' }}
                          </div>
                      </div>
          
                    </form>
                  </div>
                </tab>
    
                <tab heading="ACL" *ngIf="acllabel">
                  <div class="card-body">
                    <form [formGroup]="myFormACL">
                      <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                          <thead class="thead-light">
                            <tr>
                              <th>Activity <span class="text-danger">*</span></th>
                              <th>Description</th>
                              <th>Period <span class="text-danger">*</span></th>
                              <th>Deal Number <span class="text-danger">*</span></th>
                              <th>Allocated Amount <span class="text-danger">*</span></th>
                              <th></th>
                            </tr>
                          </thead>
                              
                          <tbody formArrayName="correctionACL">
                        
                            <tr *ngFor="let correction of correctionFormsACL.controls; let i=index" [formGroupName]="i">
                              <td><input formControlName="aclActivity"></td>
                              <td><input formControlName="aclDescription"></td>
                              <td><input class="form-control" type="date" formControlName = "aclPeriod" ></td>
                              <td><input formControlName="aclDealNumber"></td>
                              <td><input formControlNmae="aclAllocatedAmount"></td>
                              <td>
                               <button type="submit" class="btn btn-md btn-primary" (click)="deleteCorrectionACL(i)">DELETE</button> 
                              </td>
                            </tr>
                          </tbody>
                        </table>

                        <div>
                            <button type="submit" class="btn btn-md btn-primary" (click)="addCorrectionACL()">ADD ACTIVITY</button> 
                        </div>
                        <div class="text-right font-weight-bold">
                            Secured Loan Total: {{totalAmountACL | number : '.2-2' }}
                          </div>   
                      </div>
                                                  
                    </form>
                  </div>
                </tab>

                <tab heading="GPL" *ngIf="gpllabel">
                  <div class="card-body">
                    <form [formGroup]="myFormGPL">
                      <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                          <thead class="thead-light">
                            <tr>
                              <th>Activity <span class="text-danger">*</span></th>
                              <th>Description</th>
                              <th>Period <span class="text-danger">*</span></th>
                              <th>Allocated Amount <span class="text-danger">*</span></th>
                              <th></th>
                            </tr>
                          </thead>
                              
                          <tbody formArrayName="correctionsGPL">
                        
                            <tr *ngFor="let correction of correctionFormsGPL.controls; let i=index" [formGroupName]="i">
                              <td><input formControlName="gplActivity"></td>
                              <td><input formControlName="gplDescription"></td>
                              <td><input class="form-control" type="date" formControlName = "gplPeriod"></td>
                              <td><input formControlNmae="gplAllocatedAmount"></td>
                              <td><button type="submit" class="btn btn-md btn-primary" (click)="deleteCorrectionGPL(i)">DELETE</button> 
                              </td>
                            </tr>

                          </tbody>
                        </table>

                              <div>
                                  <button type="submit" class="btn btn-md btn-primary" (click)="addCorrectionGPL()">ADD ACTIVITY</button> 
                              </div>
                                
                            <div class="text-right font-weight-bold">
                                Group Total: {{totalAmountGPL | number : '.2-2' }}
                            </div>
 
                      </div>
                                                  
                    </form>
                  </div>
                </tab>


                <tab heading="TPP" *ngIf="tpplabel">
                  <div class="card-body">
                    <form [formGroup]="myFormTPP">
                      <div class="table-responsive">
                        <table class="table table-bordered table-hover">
                          <thead class="thead-light">
                            <tr>
                              <th>Activity <span class="text-danger">*</span></th> <!-- Transaction Type -->
                              <th>Activity Desc</th>
                              <th>Paypoint <span class="text-danger">*</span></th>
                              <th>Period <span class="text-danger">*</span></th>
                              <th>Gross Amount <span class="text-danger">*</span></th>
                              <th>Receipted Amount <span class="text-danger">*</span></th>
                              <th></th>
                            </tr>
                          </thead>
                                    
                          <tbody formArrayName="correctionsTPP">
                          
                            <tr *ngFor="let correction of correctionFormsTPP.controls; let i=index" [formGroupName]="i">
                              <td><input formControlName="tppActivity"></td>
                              <td><input formControlName="tppActivityDesc"></td>
                              <td><input formControlName="tppPaypoint"></td>
                              <td><input class="form-control" type="date" formControlName = "tppPeriod"></td>
                              <td><input formControlName="tppGrossAmount"></td>
                              <td><input formControlName="tppReceiptedAmount"></td>
                              <td><button type="submit" class="btn btn-md btn-primary" (click)="deleteCorrectionTPP(i)">DELETE</button> 
                              </td>
                            </tr>
                          </tbody>
                        </table>
        
                          <div>
                              <button type="submit" class="btn btn-md btn-primary" (click)="addCorrectionTPP()">ADD ACTIVITY</button> 
                          </div>
                                
                          <div  class="text-right font-weight-bold">
                              Paypoint Total : {{totalAmountTPP | number : '.2-2' }}
                          </div>
                        
                      </div>
          
                    </form>
                  </div>
                </tab>

              

              </tabset>
  
            </div>
  
          </div>
              
              <br>
    
              <!-- Controls -->
              <div class="row btn-toolbar text-center">
                <div class= "col-lg-12">
                                  
                  <div class="btn-group mr-2">
                    <button type="button" class="btn btn-md btn-primary"
                     [disabled]="!receiptDetails.valid || !paymentDetails.valid" (click)="save()">SAVE</button>
                  </div>  
        
                  <div class="btn-group mr-2">
                    <button type="button" class="btn btn-md btn-primary" 
                    (click)="clear()">CLEAR</button>
                  </div>
    
                  <div class="btn-group mr-2">
                    <a href="#"><button type="button"
                      class="btn btn-md btn-primary">Exit</button></a>
                  </div>
                    
                </div>
              </div>
                
            </div>
            
          </div>
    
        </div>
            
</div>

<!-- Receipt Allocations -->
 <div class="row">
  <div class="col-lg-12">
    <div class="card">
      <div class="card-header">
        <i class="fa fa-align-justify"></i>Receipt Allocation
      </div>
         
      <div class="card-body">

            <div class="col-lg-12">

              <div class="table-responsive">
              <table class="table table-bordered table-hover">
                <thead class="thead-light">
                  <tr>
                    <th>Application Code</th>
                    <th>Application Description</th>
                    <th>Amount Allocated</th>
                  </tr>
                </thead>
                  
                <tbody>
                  <tr *ngFor="let allocation of receiptAllocations">
                    <td>{{allocation.code}}</td>
                    <td>{{allocation.description}}</td>
                    <td class="text-right">{{allocation.amount}}</td>
                  </tr>

                  <tr class = "font-weight-bold">
                    <td colspan = "2" class="text-center">Amount</td>
                    <td class="text-right">{{totalAmount | number : '.2-2' }}</td>
                  </tr>
                    
                </tbody>
  
              </table>
            </div>
                         
            </div>
      
      </div>
      
    </div>
  </div>
</div> 

</div>